<!DOCTYPE html>
<!-- low_res_world.geo.json and html template generated at https://geojson-maps.ash.ms/ -->
<html lang="en">
<head>
    <title>Leaflet GeoJSON Example</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.1/leaflet.css" />
    <style type="text/css">
        .leaflet-container{background-color:#c5e8ff;}
    </style>

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="Jennifer Long, Danelle Cook, Chineze Okpala, Hari Somayajula, Abishua Prashanth, and Randy Weaver">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link href="https://getbootstrap.com/docs/5.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    <!-- from nyc borroughs index.html -->
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.3/dist/leaflet.css"
    integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ=="
    crossorigin=""/>

    <!-- Leaflet JavaScript code -->
    <script src="https://unpkg.com/leaflet@1.3.3/dist/leaflet.js"
    integrity="sha512-tAGcCfR4Sc5ZP5ZoVz0quoZDYX5aCtEm/eu1KhSLj2c9eFrylXZknQYmxUssFaVJKvvc0dJQixhGjG2yXWiV9Q=="
    crossorigin=""></script>

    <!-- D3 library -->
    <script src="https://d3js.org/d3.v5.min.js"></script>

    <!-- Our CSS -->
    <!-- <link rel="stylesheet" type="text/css" href="static/css/style.css"> -->

</head>

<body>
    <div class="container">
        <header class="d-flex flex-wrap justify-content-center py-3 mb-4 border-bottom">
            <a href="/" class="d-flex align-items-center mb-3 mb-md-0 me-md-auto text-dark text-decoration-none">
            <svg class="bi me-2" width="40" height="32"><use xlink:href="#bootstrap"></use></svg>
            <span class="fs-4">Fossil Fuels Impact Project</span>
            </a>
    
            <ul class="nav nav-pills">
            <li class="nav-item"><a href="/" class="nav-link active" aria-current="page">Home</a></li>
            <li class="nav-item"><a href={{content_1_location}} class="nav-link">{{content_1_title}}</a></li>
            <li class="nav-item"><a href={{content_2_location}} class="nav-link">{{content_2_title}}</a></li>
            <li class="nav-item"><a href="https://github.com/randallwvr90/fossil-fuels-and-greenhouse-gas" class="nav-link">About</a></li>
            </ul>
        </header>
    </div>

    <div id="map" style="width: 1200px; height: 800px"></div>

    <script src="http://code.jquery.com/jquery-1.10.2.min.js"></script>
    <!-- <script src="http://cdn.leafletjs.com/leaflet-0.7.1/leaflet.js"></script> -->
    <script>
        var myGeoJSONPath = '/api/low_res_world';
        var myCustomStyle = {
            stroke: false,
            fill: true,
            fillColor: '#fff',
            fillOpacity: 1
        };
        var emissionsJSONPath = '/api/v1.0/get_global_emissions';
        var sampleEmissions = 

        $.getJSON(myGeoJSONPath,function(data){
            console.log(data)
            var map = L.map('map').setView([30, 0], 2);



            // Getting our GeoJSON data
            d3.json(emissionsJSONPath).then(function(data2) {
                // Creating a GeoJSON layer with the retrieved data
                L.geoJson(data, {
                    style: function(feature) {
                        console.log(feature)
                        return {
                            color: "white",
                            // Call the chooseColor() function to decide which color to color our neighborhood. (The color is based on the borough.)
                            fillColor: chooseColor(data2, feature.properties.iso_n3),
                            fillOpacity: 0.5,
                            weight: 1.5
                        };
                    },
                    // Styling each feature (in this case, a neighborhood)
                    /* style: function(emissions) {
                        return {
                            color: "white",
                            fill: true,
                            stroke: false,
                            // Call the chooseColor() function to decide which color to color our neighborhood. (The color is based on the borough.)
                            fillColor: "black",//chooseColor(emissions[0]),
                            fillOpacity: 0.5,
                            weight: 1.5
                        };
                    } */

                    // The block below will set up mouse events!
                    /* // This is called on each feature.
                    onEachFeature: function(feature, layer) {
                    // Set the mouse events to change the map styling.
                    layer.on({
                        // When a user's mouse cursor touches a map feature, the mouseover event calls this function, which makes that feature's opacity change to 90% so that it stands out.
                        mouseover: function(event) {
                        layer = event.target;
                        layer.setStyle({
                            fillOpacity: 0.9
                        });
                        },
                        // When the cursor no longer hovers over a map feature (that is, when the mouseout event occurs), the feature's opacity reverts back to 50%.
                        mouseout: function(event) {
                        layer = event.target;
                        layer.setStyle({
                            fillOpacity: 0.5
                        });
                        },
                        // When a feature (neighborhood) is clicked, it enlarges to fit the screen.
                        click: function(event) {
                        myMap.fitBounds(event.target.getBounds());
                        }
                    });
                    // Giving each feature a popup with information that's relevant to it
                    layer.bindPopup("<h1>" + feature.properties.neighborhood + "</h1> <hr> <h2>" + feature.properties.borough + "</h2>");

                    } */
                }).addTo(map);
            });

            // L.geoJson(data, {
            //     clickable: false,
            //     style: myCustomStyle
            // }).addTo(map);
        });
        // The function that will determine the color of a neighborhood based on the borough that it belongs to
        function chooseColor(data2, countryCode) {
            emissions = getEmissions(data2, countryCode);
            console.log(emissions)
            if (emissions > 5000) return "#a60202";
            else if (emissions > 4000) return "#FC0303";
            else if (emissions > 3500) return "#FA6800";
            else if (emissions > 3000) return "#FAB700";
            else if (emissions > 2500) return "#FAED00";
            else if (emissions > 2000) return "#ABFA00";
            else if (emissions > 1500) return "#00FA0C";
            else if (emissions > 1000) return "#00FACC";
            else if (emissions > 500) return "#00CCFA";
            else if (emissions >= 0) return "#0008fa";
            else return "white";
        }
        function getEmissions(data2, countryCode) {
            console.log(countryCode)
            for (let i=0; i<data2.length; i++) {
                if (data2[i][1] == countryCode) {
                    return data2[i][0]
                }
            }
        }
    </script>
</body>
</html>